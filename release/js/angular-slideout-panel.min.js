'use strict';

angular.module('angular-slideout-panel', []);
'use strict';

//borrowed from https://github.com/angular-ui/bootstrap/blob/master/src/modal/modal.js - $uibResolve

angular.module('angular-slideout-panel').provider('panelResolve', [function () {
  this.$get = ['$injector', '$q', function ($injector, $q) {
    return {
      resolve: function resolve(invocables) {
        var promises = [];

        angular.forEach(invocables, function (value) {
          if (angular.isFunction(value) || angular.isArray(value)) {
            promises.push($q.resolve($injector.invoke(value)));
          } else if (angular.isString(value)) {
            promises.push($q.resolve($injector.get(value)));
          } else {
            promises.push($q.resolve(value));
          }
        });

        return $q.all(promises).then(function (resolves) {
          var resolveObj = {};
          var resolveIter = 0;
          angular.forEach(invocables, function (value, key) {
            resolveObj[key] = resolves[resolveIter++];
          });

          return resolveObj;
        });
      }
    };
  }];
}]);
'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

angular.module('angular-slideout-panel').service('angularSlideOutPanel', ['$q', '$rootScope', '$timeout', '$http', '$compile', '$controller', 'angularSlideOutPanelStack', 'panelResolve', function ($q, $rootScope, $timeout, $http, $compile, $controller, angularSlideOutPanelStack, panelResolve) {
  var PANEL_ELEMENT_CLASSES = {
    PANEL_BG_ELEMENT: 'angular-panel-bg'
  };

  var AngularSlideOutPanel = function () {
    function AngularSlideOutPanel() {
      _classCallCheck(this, AngularSlideOutPanel);
    }

    _createClass(AngularSlideOutPanel, [{
      key: 'open',

      /**
       * @param {Object} [options]
       * @param {String} [options.templateUrl]
       * @param {String} [options.template]
       * @param {String} [options.openOn] - 'left' or 'right' - defaults to 'left'
       */
      value: function open(options) {
        if (!options) throw new Error('angularSlideOutPanel - open() - options is required');
        if (!options.templateUrl && !options.template) throw new Error('angularSlideOutPanel - open() - options.templateUrl or options.template is required');

        options.openOn = options.openOn && (options.openOn === 'right' || options.openOn === 'left') ? options.openOn : 'left';

        return _createPanel(options);
      }
    }]);

    return AngularSlideOutPanel;
  }();

  var Panel = function () {
    /**
     * @param {Object} options
     * @param {String} [options.templateUrl]
     * @param {String} [options.template]
     * @param {String} [options.openOn]
     * @param {Object} [options.resolve]
     * @param {String|Function|Array} [options.controller]
     */
    function Panel(options) {
      var _this = this;

      _classCallCheck(this, Panel);

      if (!options) throw new Error('Panel - constructor() - options is required');

      this._deferred = $q.defer();
      this.result = this._deferred.promise;

      this.templateUrl = options.templateUrl;
      this.template = options.template;
      this.openOn = options.openOn;
      this.controller = options.controller;
      this.resolve = options.resolve;

      this._elements = _createPanelElements({
        openOn: this.openOn,
        close: this.close.bind(this),
        dismiss: this.dismiss.bind(this)
      });

      this._getControllerScope().then(function (scopeAndTemplate) {
        var scope = scopeAndTemplate.scope;
        var template = scopeAndTemplate.template;

        scope.$panelInstance = _this; //add the Panel instance to the scope so it can be closed from whatever controller the user provides

        var compiledElement = _createTemplate(scope, template);

        _this._elements.modalContentElement.append(compiledElement);

        openModalElements(_this._elements.modalBgElement);
      });
    }

    /**
     * @param {Object} controller
     * @param {Object} resolve - hash of promises to resolve
     */


    _createClass(Panel, [{
      key: '_getControllerScope',
      value: function _getControllerScope() {
        var _this2 = this;

        var templatePromise = this.templateUrl ? _getTemplate(this.templateUrl) : $q.resolve({
          data: this.template
        });

        var templateAndResolvePromise = $q.all([templatePromise, panelResolve.resolve(this.resolve)]);

        return templateAndResolvePromise.then(function (templateAndVars) {
          var locals = {};

          var newScope = $rootScope.$new();

          locals.$scope = newScope;
          locals.$scope.$resolve = {};
          locals.$panelInstance = _this2;

          var resolves = templateAndVars[1];
          angular.forEach(resolves, function (value, key) {
            locals[key] = value;

            locals.$scope.$resolve[key] = value;
          });

          var ctrlInstantiate = $controller(_this2.controller, locals, true);

          ctrlInstantiate();

          return $q.resolve({
            scope: newScope,
            template: templateAndVars[0] ? templateAndVars[0].data : null
          });
        });
      }
    }, {
      key: 'close',
      value: function close(result) {
        closeModalElements(this._elements.modalBgElement);

        this._deferred.resolve(result);
      }
    }, {
      key: 'dismiss',
      value: function dismiss(reason) {
        closeModalElements(this._elements.modalBgElement);

        this._deferred.reject(reason);
      }
    }]);

    return Panel;
  }();

  /**
   * @param {Object} [options]
   * @param {String} [options.openOn] - 'left' or 'right' - defaults to 'left'
   */


  function _createPanel(options) {
    return new Panel(options);
  }

  /**
   * @param {Object} [options]
   * @param {String} [options.openOn] - 'left' or 'right' - defaults to 'left'
   * @param {Function} [options.close] - close the modal and resolve the promise
   * @param {Function} [options.dismiss] - close the modal and reject the promise
   */
  function _createPanelElements(options) {
    options = options || {};

    var modalBgElement = getOrCreateModalBgElement(options);

    var modalDialogElement = angular.element(document.createElement('div'));
    modalDialogElement.addClass('angular-panel-dialog');
    modalDialogElement.on('click', function (event) {
      event.stopPropagation(); //prevent a click on the modal from closing it
    });

    var modalContentElement = angular.element(document.createElement('div'));
    modalContentElement.addClass('angular-panel-content');

    // let modalCloseElement = angular.element(document.createElement('div'));
    // modalCloseElement.addClass('angular-panel-close');
    // modalCloseElement.on('click', (event) => { //close the modal on close button click
    //   if (event) event.preventDefault();
    //
    //   if (options.dismiss) options.dismiss('backdrop click');
    // });

    var modalCloseAElement = angular.element(document.createElement('a'));
    modalCloseAElement.attr('href', '#');
    modalCloseAElement.addClass('tl-icon tl-icon-times');

    // modalCloseElement.append(modalCloseAElement);

    modalDialogElement.append(modalContentElement);

    modalBgElement.append(modalDialogElement);

    var bodyElement = angular.element(document.querySelector('body'));
    if (bodyElement) bodyElement.append(modalBgElement);

    return {
      modalBgElement: modalBgElement,
      modalContentElement: modalContentElement
    };
  }

  /**
   * @param {Object} [options]
   * @param {String} [options.openOn] - direction to open the panel
   */
  function getOrCreateModalBgElement(options) {
    options = options || {};

    var bodyElement = angular.element(document.querySelector('body'));

    var modalBgElement = angular.element(document.createElement('div'));

    modalBgElement.addClass(PANEL_ELEMENT_CLASSES.PANEL_BG_ELEMENT);
    modalBgElement.addClass('angular-panel-open-' + options.openOn);
    modalBgElement.on('click', function () {
      //close the modal on backgroup clicks
      if (options.dismiss) options.dismiss('backdrop click');
    });

    bodyElement.on('keydown keypress', function (event) {
      //close the modal on escape keypress
      if (event.which === 27) {
        // 27 = esc key
        event.preventDefault();

        if (options.dismiss) options.dismiss('escape key press');
      }
    });

    return modalBgElement;
  }

  function closeModalElements(modalBgElement) {
    $timeout(function () {
      modalBgElement.removeClass('open');

      $timeout(function () {
        modalBgElement.remove();
      }, 600);
    });

    var bodyElement = angular.element(document.querySelector('body'));

    bodyElement.off('keydown keypress');
  }

  function openModalElements(modalBgElement) {
    $timeout(function () {
      modalBgElement.addClass('open');
    });
  }

  function _createTemplate(newScope, htmlString) {
    var compiledElement = $compile(htmlString)(newScope);
    return compiledElement;
  }

  function _getTemplate(templateUrl) {
    return $http.get(templateUrl);
  }

  return new AngularSlideOutPanel();
}]);
'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

angular.module('angular-slideout-panel').service('angularSlideOutPanelStack', [function () {
  var AngularPanelStack = function () {
    function AngularPanelStack() {
      _classCallCheck(this, AngularPanelStack);

      this._stack = [];
    }

    _createClass(AngularPanelStack, [{
      key: '_addPanel',
      value: function _addPanel(panel) {
        if (!panel) return;

        this._stack.push(panel);
      }
    }]);

    return AngularPanelStack;
  }();

  return new AngularPanelStack();
}]);